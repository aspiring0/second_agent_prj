# ä¼ä¸šçº§ RAG å¤šæ™ºèƒ½ä½“é—®ç­”ç³»ç»Ÿ - å®Œæ•´æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [ç›®å½•ç»“æ„è¯¦è§£](#3-ç›®å½•ç»“æ„è¯¦è§£)
4. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#4-æ ¸å¿ƒæ¨¡å—è¯¦è§£)
   - 4.1 [é…ç½®å±‚ (config/)](#41-é…ç½®å±‚-config)
   - 4.2 [RAGæ¨¡å— (src/rag/)](#42-ragæ¨¡å—-srcrag)
   - 4.3 [Agentæ¨¡å— (src/agent/)](#43-agentæ¨¡å—-srcagent)
   - 4.4 [Serviceå±‚ (src/service/)](#44-serviceå±‚-srcservice)
   - 4.5 [å·¥å…·å±‚ (src/utils/)](#45-å·¥å…·å±‚-srcutils)
5. [æ•°æ®æµä¸æ‰§è¡Œæµç¨‹](#5-æ•°æ®æµä¸æ‰§è¡Œæµç¨‹)
6. [æ ¸å¿ƒæŠ€æœ¯çŸ¥è¯†ç‚¹](#6-æ ¸å¿ƒæŠ€æœ¯çŸ¥è¯†ç‚¹)
7. [ä¾èµ–ä¸ç¯å¢ƒé…ç½®](#7-ä¾èµ–ä¸ç¯å¢ƒé…ç½®)
8. [ä½¿ç”¨æŒ‡å—](#8-ä½¿ç”¨æŒ‡å—)
9. [æ‰©å±•ä¸äºŒæ¬¡å¼€å‘](#9-æ‰©å±•ä¸äºŒæ¬¡å¼€å‘)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§ RAGï¼ˆRetrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰å¤šæ™ºèƒ½ä½“é—®ç­”ç³»ç»Ÿ**ã€‚å®ƒç»“åˆäº†ï¼š

- **RAG æŠ€æœ¯**ï¼šé€šè¿‡å‘é‡æ£€ç´¢ä»çŸ¥è¯†åº“ä¸­è·å–ç›¸å…³ä¸Šä¸‹æ–‡ï¼Œå¢å¼ºå¤§æ¨¡å‹çš„å›ç­”èƒ½åŠ›
- **å¤šæ™ºèƒ½ä½“æ¶æ„**ï¼šåŸºäº LangGraph å®ç°ç ”ç©¶å‘˜ï¼ˆResearcherï¼‰å’Œä½œå®¶ï¼ˆWriterï¼‰ä¸¤ä¸ªè§’è‰²çš„åä½œ
- **çŸ¥è¯†åº“ç®¡ç†**ï¼šæ”¯æŒå¤šçŸ¥è¯†åº“ã€å¤šä¼šè¯çš„éš”ç¦»ç®¡ç†
- **Web UI**ï¼šåŸºäº Streamlit çš„äº¤äº’å¼ç•Œé¢

### 1.2 æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | æè¿° |
|---------|------|
| æ–‡æ¡£å…¥åº“ | æ”¯æŒ TXTã€PDFã€DOCXã€MDã€ä»£ç æ–‡ä»¶ç­‰å¤šç§æ ¼å¼çš„æ–‡æ¡£å¤„ç†ä¸å‘é‡åŒ–å…¥åº“ |
| è¯­ä¹‰æ£€ç´¢ | åŸºäºå‘é‡ç›¸ä¼¼åº¦çš„æ™ºèƒ½æ£€ç´¢ï¼Œæ”¯æŒ Top-K ç»“æœè¿”å› |
| å¤šçŸ¥è¯†åº“éš”ç¦» | é€šè¿‡ project_id å®ç°ä¸åŒçŸ¥è¯†åº“çš„æ•°æ®éš”ç¦» |
| ä¼šè¯ç®¡ç† | æ”¯æŒå¤šä¼šè¯ã€ä¼šè¯å†å²æŒä¹…åŒ– |
| å¤šæ™ºèƒ½ä½“åä½œ | ç ”ç©¶å‘˜è´Ÿè´£æ£€ç´¢ä¿¡æ¯ï¼Œä½œå®¶è´Ÿè´£ç”Ÿæˆæœ€ç»ˆå›ç­” |
| å·¥å…·æ‰©å±• | æ”¯æŒé€šç”¨é—®ç­”ã€æ–‡æœ¬æ€»ç»“ã€ç¿»è¯‘ã€ä»£ç åˆ†æã€æ—¶é—´æŸ¥è¯¢ã€æ•°å­¦è®¡ç®—ç­‰å¤šç§å·¥å…· |

### 1.3 æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯å±‚    â”‚  Streamlit (web_app.py)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœåŠ¡å±‚    â”‚  ChatService / KnowledgeBaseService / DocumentService â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agentå±‚   â”‚  LangGraph (StateGraph) + LangChain            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RAGå±‚     â”‚  ETL + VectorStore + Retriever + Generator     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­˜å‚¨å±‚    â”‚  ChromaDB (å‘é‡) + SQLite (ä¼šè¯/æ¶ˆæ¯)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¨¡å‹å±‚    â”‚  OpenAI API (GPT-3.5/4 + text-embedding-3-small) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ç”¨æˆ·ç•Œé¢ (Streamlit)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   çŸ¥è¯†åº“ç®¡ç†é¡µ   â”‚  â”‚    èŠå¤©é¡µé¢     â”‚  â”‚   æ–‡ä»¶ä¸Šä¼ ç»„ä»¶   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                    â”‚
            â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Service å±‚ (ä¸šåŠ¡é€»è¾‘)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚KBService        â”‚  â”‚ChatService      â”‚  â”‚DocumentService  â”‚          â”‚
â”‚  â”‚ - çŸ¥è¯†åº“CRUD    â”‚  â”‚ - æ¶ˆæ¯ç®¡ç†      â”‚  â”‚ - æ–‡ä»¶å¤„ç†      â”‚          â”‚
â”‚  â”‚ - ä¼šè¯ç®¡ç†      â”‚  â”‚ - Agentè°ƒç”¨     â”‚  â”‚ - å…¥åº“æµç¨‹      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                    â”‚
            â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Agent å±‚ (LangGraph çŠ¶æ€æœº)                        â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚ Researcher  â”‚ â”€â”€â”€â–¶ â”‚   Tools     â”‚ â”€â”€â”€â–¶ â”‚ Researcher  â”‚ (å¾ªç¯)      â”‚
â”‚   â”‚ (ç ”ç©¶å‘˜)    â”‚      â”‚ (å·¥å…·æ‰§è¡Œ)   â”‚      â”‚             â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                    â”‚                    â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                              â–¼                                          â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚                       â”‚   Writer    â”‚ â”€â”€â”€â–¶ END                         â”‚
â”‚                       â”‚   (ä½œå®¶)    â”‚                                   â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                          â”‚
            â–¼                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           RAG æ ¸å¿ƒå±‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ETL             â”‚  â”‚ VectorStore     â”‚  â”‚ Generator       â”‚          â”‚
â”‚  â”‚ - æ–‡æ¡£åŠ è½½      â”‚  â”‚ - ChromaDB      â”‚  â”‚ - Promptæ¨¡æ¿    â”‚          â”‚
â”‚  â”‚ - æ™ºèƒ½åˆ‡åˆ†      â”‚  â”‚ - å‘é‡æŒä¹…åŒ–    â”‚  â”‚ - LLMè°ƒç”¨       â”‚          â”‚
â”‚  â”‚ - å…ƒæ•°æ®ç®¡ç†    â”‚  â”‚ - ç›¸ä¼¼åº¦æ£€ç´¢    â”‚  â”‚ - ç­”æ¡ˆç”Ÿæˆ      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ•°æ®å­˜å‚¨å±‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   ChromaDB (å‘é‡æ•°æ®åº“)  â”‚    â”‚   SQLite (å…³ç³»æ•°æ®åº“)   â”‚             â”‚
â”‚  â”‚   - æ–‡æ¡£å‘é‡å­˜å‚¨         â”‚    â”‚   - ä¼šè¯ç®¡ç†            â”‚             â”‚
â”‚  â”‚   - è¯­ä¹‰æ£€ç´¢             â”‚    â”‚   - æ¶ˆæ¯å†å²            â”‚             â”‚
â”‚  â”‚   - å…ƒæ•°æ®è¿‡æ»¤           â”‚    â”‚   - çŸ¥è¯†åº“å…ƒä¿¡æ¯        â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµå‘

```
ç”¨æˆ·æé—® â†’ ChatService â†’ Agent Graph â†’ ResearcherèŠ‚ç‚¹
                                          â†“
                                    åˆ¤æ–­æ˜¯å¦éœ€è¦å·¥å…·
                                          â†“
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â†“                       â†“
                         éœ€è¦å·¥å…·                  ä¸éœ€è¦å·¥å…·
                              â†“                       â†“
                     ToolNodeæ‰§è¡Œå·¥å…·           WriterèŠ‚ç‚¹
                     (ask_knowledge_base)            â†“
                              â†“                 ç”Ÿæˆæœ€ç»ˆå›ç­”
                     è¿”å›æ£€ç´¢ç»“æœ                     â†“
                              â†“               ä¿å­˜åˆ°SQLite
                     å›åˆ°Researcher                    â†“
                              â†“                  è¿”å›ç”¨æˆ·
                     ç»§ç»­åˆ¤æ–­/è½¬åˆ°Writer
```

---

## 3. ç›®å½•ç»“æ„è¯¦è§£

```
Enterprise_RAG_Agent/
â”‚
â”œâ”€â”€ config/                          # ã€é…ç½®å±‚ã€‘å…¨å±€é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ __init__.py                  # é…ç½®æ¨¡å—åˆå§‹åŒ–
â”‚   â””â”€â”€ settings.py                  # é›†ä¸­ç®¡ç† API Keyã€è·¯å¾„ã€æ¨¡å‹å‚æ•°
â”‚
â”œâ”€â”€ data/                            # ã€æ•°æ®å±‚ã€‘
â”‚   â”œâ”€â”€ raw/                         # å­˜æ”¾åŸå§‹æ–‡æ¡£ (PDF, MD, TXT)
â”‚   â””â”€â”€ vector_db/                   # ChromaDB æŒä¹…åŒ–å­˜å‚¨ç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚
â”œâ”€â”€ logs/                            # ã€æ—¥å¿—å±‚ã€‘ç³»ç»Ÿè¿è¡Œæ—¥å¿—ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ app.log                      # è½®è½¬æ—¥å¿—æ–‡ä»¶
â”‚
â”œâ”€â”€ scripts/                         # ã€è„šæœ¬å±‚ã€‘è¿ç»´/åˆå§‹åŒ–è„šæœ¬
â”‚   â””â”€â”€ ingest_knowledge.py          # çŸ¥è¯†å…¥åº“å…¥å£è„šæœ¬ï¼ˆå‘½ä»¤è¡Œï¼‰
â”‚
â”œâ”€â”€ src/                             # ã€æ ¸å¿ƒä»£ç å±‚ã€‘
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ rag/                         # RAG æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ etl.py                   # Extract, Transform (æ–‡æ¡£åŠ è½½ä¸åˆ‡åˆ†)
â”‚   â”‚   â”œâ”€â”€ vectorstore.py           # Load (å‘é‡åº“ç®¡ç†)
â”‚   â”‚   â”œâ”€â”€ retriever.py             # Retrieve (è¯­ä¹‰æ£€ç´¢)
â”‚   â”‚   â””â”€â”€ generator.py             # Generate (ç­”æ¡ˆç”Ÿæˆ)
â”‚   â”‚
â”‚   â”œâ”€â”€ agent/                       # å¤šæ™ºèƒ½ä½“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ state.py                 # AgentState çŠ¶æ€å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ tools.py                 # å·¥å…·å‡½æ•°å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ nodes.py                 # AgentèŠ‚ç‚¹å®ç°
â”‚   â”‚   â””â”€â”€ graph.py                 # LangGraph çŠ¶æ€æœºç¼–æ’
â”‚   â”‚
â”‚   â”œâ”€â”€ service/                     # æœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py              # æœåŠ¡å±‚å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ kb_service.py            # çŸ¥è¯†åº“ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ chat_service.py          # èŠå¤©æœåŠ¡
â”‚   â”‚   â””â”€â”€ document_service.py      # æ–‡æ¡£å¤„ç†æœåŠ¡
â”‚   â”‚
â”‚   â””â”€â”€ utils/                       # é€šç”¨å·¥å…·
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ db.py                    # SQLite æ•°æ®åº“æ“ä½œ
â”‚       â””â”€â”€ logger.py                # ç»Ÿä¸€æ—¥å¿—é…ç½®
â”‚
â”œâ”€â”€ web_app.py                       # Streamlit Webåº”ç”¨å…¥å£
â”œâ”€â”€ main.py                          # å‘½ä»¤è¡Œäº¤äº’å…¥å£
â”œâ”€â”€ .env                             # ç¯å¢ƒå˜é‡ï¼ˆAPIå¯†é’¥ç­‰ï¼‰
â”œâ”€â”€ .gitignore                       # Gitå¿½ç•¥é…ç½®
â”œâ”€â”€ chat_history.db                  # SQLiteæ•°æ®åº“æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â””â”€â”€ README.md                        # é¡¹ç›®è¯´æ˜
```

---

## 4. æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 4.1 é…ç½®å±‚ (config/)

#### `config/settings.py`

**èŒè´£**ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®é¡¹ï¼Œå®ç°é…ç½®ä¸ä»£ç åˆ†ç¦»ã€‚

```python
class Settings:
    # åŸºç¡€è·¯å¾„é…ç½®
    BASE_DIR = Path(__file__).resolve().parent.parent  # é¡¹ç›®æ ¹ç›®å½•
    DATA_DIR = BASE_DIR / "data" / "raw"               # åŸå§‹æ–‡æ¡£ç›®å½•
    DB_DIR = BASE_DIR / "data" / "vector_db"           # å‘é‡æ•°æ®åº“ç›®å½•
    LOG_DIR = BASE_DIR / "logs"                        # æ—¥å¿—ç›®å½•

    # LLM & Embedding é…ç½®
    OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")       # APIå¯†é’¥
    OPENAI_BASE_URL = os.getenv("OPENAI_API_BASE")     # APIåœ°å€ï¼ˆæ”¯æŒä»£ç†/å…¼å®¹æ¥å£ï¼‰
    
    # æ¨¡å‹é€‰æ‹©
    EMBEDDING_MODEL = "text-embedding-3-small"         # å‘é‡åŒ–æ¨¡å‹
    CHAT_MODEL = "gpt-3.5-turbo"                       # å¯¹è¯æ¨¡å‹
    
    # RAG ä¸šåŠ¡å‚æ•°
    CHUNK_SIZE = 800           # åˆ‡ç‰‡å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰
    CHUNK_OVERLAP = 100        # åˆ‡ç‰‡é‡å ï¼ˆé˜²æ­¢è¯­ä¹‰æ–­è£‚ï¼‰
```

**è®¾è®¡æ¨¡å¼**ï¼šå•ä¾‹æ¨¡å¼ + é›†ä¸­é…ç½®

**çŸ¥è¯†ç‚¹**ï¼š
- `pathlib.Path`ï¼šè·¨å¹³å°è·¯å¾„å¤„ç†
- `python-dotenv`ï¼šä» `.env` æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡
- é…ç½®åˆ†ç¦»åŸåˆ™ï¼šæ•æ„Ÿä¿¡æ¯ï¼ˆAPI Keyï¼‰ä¸ä»£ç åˆ†ç¦»

---

### 4.2 RAGæ¨¡å— (src/rag/)

RAG æ˜¯æœ¬ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œåˆ†ä¸ºå››ä¸ªå­æ¨¡å—ï¼š

#### 4.2.1 ETLæ¨¡å— (`etl.py`)

**èŒè´£**ï¼šæ–‡æ¡£çš„åŠ è½½ï¼ˆExtractï¼‰ä¸åˆ‡åˆ†ï¼ˆTransformï¼‰ã€‚

**æ ¸å¿ƒç±»**ï¼š`ContentProcessor`

```python
class ContentProcessor:
    def load_uploaded_files(self, uploaded_files) -> List[Document]:
        """åŠ è½½ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè¿”å›æ–‡æ¡£åˆ—è¡¨"""
        
    def split_documents(self, documents) -> List[Document]:
        """æ™ºèƒ½åˆ‡åˆ†æ–‡æ¡£"""
```

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š

1. **å¤šæ ¼å¼æ–‡æ¡£åŠ è½½å™¨**ï¼š
   ```python
   # æ ¹æ®æ–‡ä»¶åç¼€é€‰æ‹©åŠ è½½å™¨
   .txt  â†’ TextLoader (æ”¯æŒUTF-8/GBKç¼–ç è‡ªåŠ¨æ£€æµ‹)
   .md   â†’ UnstructuredMarkdownLoader
   .pdf  â†’ PyPDFLoader
   .docx â†’ Docx2txtLoader
   .py/.js/.java ç­‰ â†’ TextLoader
   ```

2. **ä¸´æ—¶æ–‡ä»¶æŠ€æœ¯**ï¼š
   - Streamlitä¸Šä¼ çš„æ–‡ä»¶åœ¨å†…å­˜ä¸­
   - LangChain Loaderéœ€è¦æ–‡ä»¶è·¯å¾„
   - ä½¿ç”¨ `tempfile.NamedTemporaryFile` æ¡¥æ¥

3. **æ™ºèƒ½åˆ‡åˆ†ç­–ç•¥**ï¼š
   ```python
   # ä¸­æ–‡æ–‡æ¡£åˆ†éš”ç¬¦ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰
   CHINESE_SEPARATORS = [
       "\n\n",    # æ®µè½åˆ†éš”
       "\n",      # è¡Œåˆ†éš”
       "ã€‚",      # ä¸­æ–‡å¥å·
       "ï¼", "ï¼Ÿ", "ï¼›", "ï¼Œ", "ï¼š",
       ...
   ]
   
   # Markdownæ–‡æ¡£åˆ†éš”ç¬¦
   MARKDOWN_SEPARATORS = [
       "\n\n", "```", "## ", "### ", ...
   ]
   ```

4. **RecursiveCharacterTextSplitter**ï¼š
   - é€’å½’åœ°å°è¯•ä¸åŒçš„åˆ†éš”ç¬¦
   - ç›´åˆ°æ‰¾åˆ°èƒ½å¤Ÿä¿æŒè¯­ä¹‰å®Œæ•´çš„åˆ‡åˆ†ç‚¹
   - `chunk_overlap` ä¿è¯å—ä¹‹é—´æœ‰é‡å ï¼Œé˜²æ­¢å…³é”®ä¿¡æ¯è¢«åˆ‡æ–­

**æ•°æ®ç»“æ„**ï¼š
```python
Document {
    page_content: str,      # æ–‡æ¡£å†…å®¹
    metadata: {
        source: str,        # æ¥æºæ–‡ä»¶å
        file_type: str,     # æ–‡ä»¶ç±»å‹
        project_id: str     # æ‰€å±çŸ¥è¯†åº“ID
    }
}
```

---

#### 4.2.2 å‘é‡å­˜å‚¨æ¨¡å— (`vectorstore.py`)

**èŒè´£**ï¼šæ–‡æ¡£å‘é‡åŒ–ä¸æŒä¹…åŒ–å­˜å‚¨ã€‚

**æ ¸å¿ƒç±»**ï¼š`VectorDBManager`

```python
class VectorDBManager:
    def __init__(self):
        self.embedding_fn = OpenAIEmbeddings(
            model="text-embedding-3-small",
            openai_api_key=...,
            openai_api_base=...
        )
    
    def create_vector_db(self, chunks, project_id: str):
        """å°†æ–‡æ¡£å—å­˜å…¥å‘é‡æ•°æ®åº“"""
```

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š

1. **å‘é‡åµŒå…¥ï¼ˆEmbeddingï¼‰**ï¼š
   - å°†æ–‡æœ¬è½¬æ¢ä¸ºé«˜ç»´å‘é‡ï¼ˆå¦‚1536ç»´ï¼‰
   - è¯­ä¹‰ç›¸è¿‘çš„æ–‡æœ¬åœ¨å‘é‡ç©ºé—´ä¸­è·ç¦»è¾ƒè¿‘
   - ä½¿ç”¨ OpenAI çš„ `text-embedding-3-small` æ¨¡å‹

2. **ChromaDB**ï¼š
   - å¼€æºçš„æœ¬åœ°å‘é‡æ•°æ®åº“
   - æ”¯æŒæŒä¹…åŒ–å­˜å‚¨ï¼ˆ`persist_directory`ï¼‰
   - æ”¯æŒå…ƒæ•°æ®è¿‡æ»¤ï¼ˆ`filter={"project_id": "xxx"}`ï¼‰

3. **çŸ¥è¯†åº“éš”ç¦»**ï¼š
   - æ¯ä¸ªæ–‡æ¡£å—çš„ metadata ä¸­æ·»åŠ  `project_id`
   - æ£€ç´¢æ—¶é€šè¿‡å…ƒæ•°æ®è¿‡æ»¤å®ç°å¤šç§Ÿæˆ·éš”ç¦»

---

#### 4.2.3 æ£€ç´¢æ¨¡å— (`retriever.py`)

**èŒè´£**ï¼šæ ¹æ®ç”¨æˆ·é—®é¢˜è¿›è¡Œè¯­ä¹‰æ£€ç´¢ã€‚

**æ ¸å¿ƒç±»**ï¼š`VectorRetriever`

```python
class VectorRetriever:
    def query(self, question: str, project_id: str, top_k=3):
        """è¯­ä¹‰æ£€ç´¢ï¼Œè¿”å›æœ€ç›¸å…³çš„Kä¸ªæ–‡æ¡£"""
        results = self.vector_db.similarity_search_with_score(
            question,
            k=top_k,
            filter={"project_id": project_id}
        )
        return results  # [(Document, score), ...]
```

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š

1. **ä½™å¼¦ç›¸ä¼¼åº¦**ï¼š
   - è®¡ç®—é—®é¢˜å‘é‡ä¸æ–‡æ¡£å‘é‡çš„å¤¹è§’ä½™å¼¦å€¼
   - å€¼è¶Šå¤§è¡¨ç¤ºè¶Šç›¸ä¼¼

2. **Top-K æ£€ç´¢**ï¼š
   - è¿”å›ç›¸ä¼¼åº¦æœ€é«˜çš„ K ä¸ªç»“æœ
   - é»˜è®¤ K=3

3. **å…ƒæ•°æ®è¿‡æ»¤**ï¼š
   - æ£€ç´¢å‰å…ˆè¿‡æ»¤å‡ºæŒ‡å®šçŸ¥è¯†åº“çš„æ–‡æ¡£
   - å®ç°æ•°æ®éš”ç¦»

---

#### 4.2.4 ç”Ÿæˆæ¨¡å— (`generator.py`)

**èŒè´£**ï¼šåŸºäºæ£€ç´¢ç»“æœç”Ÿæˆæœ€ç»ˆå›ç­”ã€‚

**æ ¸å¿ƒç±»**ï¼š`RAGGenerator`

```python
class RAGGenerator:
    def __init__(self):
        self.retriever = VectorRetriever()
        self.llm = ChatOpenAI(model="gpt-3.5-turbo", temperature=0.1)
        self.prompt_template = ChatPromptTemplate.from_template(...)
    
    def get_answer(self, question: str, session_id, project_id) -> str:
        """ç”Ÿæˆå›ç­”"""
```

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š

1. **Prompt æ¨¡æ¿**ï¼š
   ```python
   prompt_template = """
   ä½ æ˜¯ä¸€ä¸ªçŸ¥è¯†åº“é—®ç­”åŠ©æ‰‹ã€‚
   
   ã€æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ã€‘:
   {context}
   
   ã€ç”¨æˆ·é—®é¢˜ã€‘:
   {question}
   
   ã€å›ç­”è§„åˆ™ã€‘:
   1. å¿…é¡»åŸºäºä¸Šä¸‹æ–‡å›ç­”
   2. ç¦æ­¢è¯´"æœªæ‰¾åˆ°"
   ...
   """
   ```

2. **LCELï¼ˆLangChain Expression Languageï¼‰**ï¼š
   ```python
   rag_chain = prompt_template | llm | StrOutputParser()
   answer = rag_chain.invoke({"context": context, "question": question})
   ```
   - `|` æ“ä½œç¬¦å®ç°é“¾å¼è°ƒç”¨
   - ç±»ä¼¼äº Unix ç®¡é“

3. **ä¸Šä¸‹æ–‡æ ¼å¼åŒ–**ï¼š
   ```python
   def _format_docs(self, docs):
       """å°†æ–‡æ¡£åˆ—è¡¨æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²"""
       formatted = []
       for i, doc in enumerate(docs):
           source = doc.metadata.get('source', 'æœªçŸ¥æ¥æº')
           formatted.append(f"ã€æ–‡æ¡£{i+1} æ¥æº: {source}ã€‘\n{doc.page_content}")
       return "\n\n".join(formatted)
   ```

---

### 4.3 Agentæ¨¡å— (src/agent/)

#### 4.3.1 çŠ¶æ€å®šä¹‰ (`state.py`)

**èŒè´£**ï¼šå®šä¹‰æ™ºèƒ½ä½“ä¹‹é—´ä¼ é€’çš„æ•°æ®ç»“æ„ã€‚

```python
class AgentState(TypedDict):
    messages: Annotated[List[BaseMessage], operator.add]  # æ¶ˆæ¯åˆ—è¡¨ï¼ˆç´¯åŠ ï¼‰
    next_step: str                                        # ä¸‹ä¸€æ­¥æŒ‡ç¤º
```

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š

1. **TypedDict**ï¼š
   - Python ç±»å‹æç¤ºï¼Œå®šä¹‰å­—å…¸çš„é”®å€¼ç±»å‹
   - æé«˜ä»£ç å¯è¯»æ€§å’Œ IDE æ”¯æŒ

2. **Annotated + operator.add**ï¼š
   - `Annotated[List[BaseMessage], operator.add]` è¡¨ç¤ºå½“æœ‰æ–°æ¶ˆæ¯æ—¶ï¼Œè¿½åŠ åˆ°åˆ—è¡¨è€Œéè¦†ç›–
   - è¿™æ˜¯ LangGraph çš„çŠ¶æ€èšåˆæœºåˆ¶

3. **BaseMessage**ï¼š
   - LangChain çš„æ¶ˆæ¯åŸºç±»
   - å­ç±»åŒ…æ‹¬ï¼š`HumanMessage`ï¼ˆç”¨æˆ·æ¶ˆæ¯ï¼‰ã€`AIMessage`ï¼ˆAIæ¶ˆæ¯ï¼‰ã€`ToolMessage`ï¼ˆå·¥å…·è¿”å›ï¼‰

---

#### 4.3.2 å·¥å…·å®šä¹‰ (`tools.py`)

**èŒè´£**ï¼šå®šä¹‰æ™ºèƒ½ä½“å¯è°ƒç”¨çš„å·¥å…·å‡½æ•°ã€‚

**æ ¸å¿ƒå·¥å…·åˆ—è¡¨**ï¼š

| å·¥å…·å | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|-------|------|---------|
| `ask_knowledge_base` | çŸ¥è¯†åº“è¯­ä¹‰æ£€ç´¢ | ç”¨æˆ·æœ‰å…·ä½“é—®é¢˜éœ€è¦æŸ¥è¯¢æ–‡æ¡£ |
| `list_knowledge_base_files` | åˆ—å‡ºçŸ¥è¯†åº“æ–‡ä»¶ | ç”¨æˆ·é—®"æœ‰å“ªäº›æ–‡ä»¶" |
| `search_by_filename` | æŒ‰æ–‡ä»¶åæœç´¢ | ç”¨æˆ·æåˆ°å…·ä½“æ–‡ä»¶åæˆ–ç±»å‹ |
| `general_qa` | é€šç”¨é—®ç­” | ç¼–ç¨‹é—®é¢˜ã€æ¦‚å¿µè§£é‡Šç­‰ |
| `summarize_text` | æ–‡æœ¬æ€»ç»“ | ç”¨æˆ·è¦æ±‚æ€»ç»“å†…å®¹ |
| `translate_text` | ç¿»è¯‘ | ç”¨æˆ·è¦æ±‚ç¿»è¯‘ |
| `analyze_code` | ä»£ç åˆ†æ | ç”¨æˆ·æäº¤ä»£ç è¯·æ±‚åˆ†æ |
| `get_current_time` | è·å–æ—¶é—´ | ç”¨æˆ·é—®æ—¶é—´ |
| `calculate_expression` | æ•°å­¦è®¡ç®— | æ•°å­¦è¡¨è¾¾å¼æ±‚å€¼ |

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š

1. **@tool è£…é¥°å™¨**ï¼š
   ```python
   from langchain_core.tools import tool
   
   @tool
   def ask_knowledge_base(query: str, config: RunnableConfig) -> str:
       """
       çŸ¥è¯†åº“è¯­ä¹‰æœç´¢å·¥å…·ã€‚
       å‚æ•°:
           query: ç”¨æˆ·é—®é¢˜
       """
       # å‡½æ•°å®ç°
   ```
   - å°†æ™®é€š Python å‡½æ•°è½¬æ¢ä¸º LangChain Tool
   - å‡½æ•°çš„ docstring ä¼šä½œä¸ºå·¥å…·çš„æè¿°ï¼Œå¸®åŠ© LLM ç†è§£ä½•æ—¶ä½¿ç”¨

2. **RunnableConfig**ï¼š
   - LangChain çš„é…ç½®ä¼ é€’æœºåˆ¶
   - é€šè¿‡ `config["configurable"]` è·å–è¿è¡Œæ—¶å‚æ•°
   - å¦‚ `session_id`ã€`project_id`

3. **å·¥å…·ä¸çŠ¶æ€æœºé›†æˆ**ï¼š
   - å·¥å…·é€šè¿‡ `bind_tools()` ç»‘å®šåˆ° LLM
   - LLM æ ¹æ®ç”¨æˆ·è¾“å…¥å†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·
   - ToolNode è‡ªåŠ¨æ‰§è¡Œå·¥å…·å¹¶è¿”å›ç»“æœ

---

#### 4.3.3 èŠ‚ç‚¹å®ç° (`nodes.py`)

**èŒè´£**ï¼šå®ç°æ™ºèƒ½ä½“çš„å…·ä½“è¡Œä¸ºé€»è¾‘ã€‚

**èŠ‚ç‚¹1ï¼šç ”ç©¶å‘˜ï¼ˆResearcherï¼‰**

```python
def researcher_node(state: AgentState) -> AgentState:
    """ç ”ç©¶å‘˜èŠ‚ç‚¹ï¼šåˆ†æéœ€æ±‚ï¼Œè°ƒç”¨å·¥å…·è·å–ä¿¡æ¯"""
    
    # 1. è·å–å†å²æ¶ˆæ¯
    messages = state["messages"]
    
    # 2. è®¾ç½®äººè®¾ï¼ˆSystem Promptï¼‰
    system_prompt = SystemMessage(content="""
    ä½ æ˜¯ä¸€ä¸ªå…¨èƒ½æ™ºèƒ½åŠ©æ‰‹ï¼Œå…·å¤‡å¤šç§æŠ€èƒ½...
    
    ã€æ™ºèƒ½è·¯ç”±ç­–ç•¥ã€‘ï¼š
    - æ¶‰åŠæ–‡æ¡£ â†’ ä½¿ç”¨çŸ¥è¯†åº“å·¥å…·
    - ç¼–ç¨‹é—®é¢˜ â†’ ä½¿ç”¨ general_qa
    - æ–‡æœ¬å¤„ç† â†’ ä½¿ç”¨å¯¹åº”å·¥å…·
    ...
    """)
    
    # 3. è°ƒç”¨æ¨¡å‹ï¼ˆå¸¦å·¥å…·ç»‘å®šï¼‰
    response = llm_with_tools.invoke([system_prompt] + messages)
    
    # 4. è¿”å›ç»“æœï¼ˆè¿½åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ï¼‰
    return {"messages": [response]}
```

**èŠ‚ç‚¹2ï¼šä½œå®¶ï¼ˆWriterï¼‰**

```python
def writer_node(state: AgentState):
    """ä½œå®¶èŠ‚ç‚¹ï¼šåŸºäºæ£€ç´¢ç»“æœï¼Œæ’°å†™æœ€ç»ˆå›ç­”"""
    
    # 1. å°†å†å²æ¶ˆæ¯è½¬æ¢ä¸ºå­—ç¬¦ä¸²
    conversation_str = "\n".join([
        f"ã€{msg.type}ã€‘: {msg.content}" 
        for msg in state["messages"]
    ])
    
    # 2. è°ƒç”¨ LLM ç”Ÿæˆå›ç­”
    prompt = ChatPromptTemplate.from_template("""
    ä½ æ˜¯èµ„æ·±æŠ€æœ¯ä½œå®¶ã€‚
    è¯·é˜…è¯»ä¸‹é¢çš„ã€å¯¹è¯å†å²ã€‘ï¼ŒåŸºäºäº‹å®å†™ä¸€ç¯‡ç»“æ„æ¸…æ™°çš„å›ç­”ã€‚
    
    ã€å¯¹è¯å†å²ã€‘:
    {history}
    """)
    
    chain = prompt | llm
    response = chain.invoke({"history": conversation_str})
    
    return {"messages": [response]}
```

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š

1. **SystemMessage vs HumanMessage**ï¼š
   - `SystemMessage`ï¼šè®¾å®š AI çš„è¡Œä¸ºå‡†åˆ™å’Œäººè®¾
   - `HumanMessage`ï¼šç”¨æˆ·çš„è¾“å…¥

2. **bind_tools**ï¼š
   ```python
   llm_with_tools = llm.bind_tools(all_tools)
   ```
   - å‘Šè¯‰ LLM æœ‰å“ªäº›å·¥å…·å¯ç”¨
   - LLM å¯ä»¥åœ¨å“åº”ä¸­è¿”å› `tool_calls`ï¼ˆå·¥å…·è°ƒç”¨è¯·æ±‚ï¼‰

3. **Tool Calls æœºåˆ¶**ï¼š
   - å½“ LLM å†³å®šè°ƒç”¨å·¥å…·æ—¶ï¼Œå“åº”ä¸­åŒ…å« `tool_calls`
   - `tool_calls` åŒ…å«ï¼šå·¥å…·åã€å‚æ•°
   - ToolNode æ‰§è¡Œå·¥å…·ï¼Œè¿”å› `ToolMessage`

---

#### 4.3.4 å›¾ç¼–æ’ (`graph.py`)

**èŒè´£**ï¼šä½¿ç”¨ LangGraph ç¼–æ’æ™ºèƒ½ä½“å·¥ä½œæµã€‚

```python
from langgraph.graph import StateGraph, END
from langgraph.prebuilt import ToolNode

# 1. åˆ›å»ºçŠ¶æ€å›¾
workflow = StateGraph(AgentState)

# 2. æ·»åŠ èŠ‚ç‚¹
workflow.add_node("researcher", researcher_node)
workflow.add_node("writer", writer_node)
workflow.add_node("tools", ToolNode(all_tools))

# 3. è®¾ç½®å…¥å£
workflow.set_entry_point("researcher")

# 4. æ¡ä»¶åˆ†æ”¯
def should_continue(state: AgentState):
    """åˆ¤æ–­ä¸‹ä¸€æ­¥"""
    last_message = state["messages"][-1]
    if last_message.tool_calls:
        return "tools"  # éœ€è¦è°ƒç”¨å·¥å…·
    return "writer"     # å¯ä»¥å†™å›ç­”äº†

workflow.add_conditional_edges(
    "researcher",
    should_continue,
    {"tools": "tools", "writer": "writer"}
)

# 5. å›ºå®šè¾¹
workflow.add_edge("tools", "researcher")  # å·¥å…·æ‰§è¡Œå®Œå›åˆ°ç ”ç©¶å‘˜
workflow.add_edge("writer", END)          # ä½œå®¶å†™å®Œå°±ç»“æŸ

# 6. ç¼–è¯‘
app = workflow.compile()
```

**æµç¨‹å›¾**ï¼š

```
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   START         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Researcher    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   (ç ”ç©¶å‘˜)      â”‚           â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                   â”‚                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
          â”‚ should_continue â”‚           â”‚
          â”‚   (æ¡ä»¶åˆ¤æ–­)     â”‚           â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                   â”‚                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
        â–¼                     â–¼         â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚   tools   â”‚        â”‚   writer  â”‚    â”‚
  â”‚  (å·¥å…·)   â”‚        â”‚   (ä½œå®¶)  â”‚    â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚                    â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                   â”‚                    â”‚
                   â–¼                    â”‚
              (å›åˆ°ç ”ç©¶å‘˜)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚      END        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š

1. **StateGraph**ï¼š
   - LangGraph çš„æ ¸å¿ƒç±»
   - åŸºäºçŠ¶æ€çš„å›¾ç»“æ„ï¼ŒèŠ‚ç‚¹é—´é€šè¿‡çŠ¶æ€ä¼ é€’æ•°æ®

2. **ToolNode**ï¼š
   - LangGraph é¢„ç½®çš„å·¥å…·æ‰§è¡ŒèŠ‚ç‚¹
   - è‡ªåŠ¨è¯†åˆ« `tool_calls` å¹¶æ‰§è¡Œå¯¹åº”å·¥å…·

3. **æ¡ä»¶è¾¹ï¼ˆConditional Edgesï¼‰**ï¼š
   - æ ¹æ®è¿è¡Œæ—¶çŠ¶æ€å†³å®šä¸‹ä¸€æ­¥
   - å®ç°åŠ¨æ€æµç¨‹æ§åˆ¶

4. **ç¼–è¯‘ï¼ˆcompileï¼‰**ï¼š
   - å°†å›¾å®šä¹‰è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„ `Runnable` å¯¹è±¡
   - æ”¯æŒ `invoke()`ã€`stream()` ç­‰æ–¹æ³•

---

### 4.4 Serviceå±‚ (src/service/)

Serviceå±‚è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œä¸UIå±‚è§£è€¦ã€‚

#### 4.4.1 çŸ¥è¯†åº“æœåŠ¡ (`kb_service.py`)

```python
class KnowledgeBaseService:
    def get_all_kbs(self) -> List[KnowledgeBase]
    def create_kb(self, kb_id: str, name: str) -> bool
    def delete_kb(self, kb_id: str) -> Tuple[bool, str]
    def get_kb_stats(self, kb_id: str) -> KnowledgeBaseStats
    def get_kb_files(self, kb_id: str) -> List[FileRecord]
    def get_or_create_session(self, kb_id: str, session_id) -> str
```

**åŠŸèƒ½**ï¼š
- çŸ¥è¯†åº“çš„ CRUD æ“ä½œ
- ä¼šè¯ç®¡ç†
- ç»Ÿè®¡ä¿¡æ¯æŸ¥è¯¢

#### 4.4.2 èŠå¤©æœåŠ¡ (`chat_service.py`)

```python
class ChatService:
    def get_history(self, session_id: str) -> List[ChatMessage]
    def save_user_message(self, session_id: str, content: str)
    def save_assistant_message(self, session_id: str, content: str)
    def stream_agent_response(self, prompt, session_id, project_id) -> Iterator
    def chat(self, prompt, session_id, project_id) -> Tuple[bool, str, List]
```

**åŠŸèƒ½**ï¼š
- æ¶ˆæ¯çš„å­˜å–
- Agent çš„è°ƒç”¨ä¸æµå¼å“åº”
- äº‹ä»¶ï¼ˆEventï¼‰çš„æŠ½è±¡ä¸ä¼ é€’

**äº‹ä»¶ç±»å‹**ï¼š
```python
class AgentNodeType(Enum):
    RESEARCHER = "researcher"  # ç ”ç©¶å‘˜èŠ‚ç‚¹
    TOOLS = "tools"            # å·¥å…·èŠ‚ç‚¹
    WRITER = "writer"          # ä½œå®¶èŠ‚ç‚¹
```

#### 4.4.3 æ–‡æ¡£æœåŠ¡ (`document_service.py`)

```python
class DocumentService:
    def process_and_ingest(self, uploaded_files, project_id) -> IngestResult
    def get_supported_formats(self) -> List[str]
    def is_supported(self, filename: str) -> bool
    def filter_supported_files(self, files) -> Tuple[List, List]
```

**åŠŸèƒ½**ï¼š
- æ–‡ä»¶ä¸Šä¼ å¤„ç†
- è°ƒç”¨ ETL å’Œ VectorStore å®Œæˆå…¥åº“
- è¿”å›å…¥åº“ç»“æœ

**å…¥åº“æµç¨‹**ï¼š
```
ä¸Šä¼ æ–‡ä»¶ â†’ ContentProcessor.load_uploaded_files()
         â†’ ContentProcessor.split_documents()
         â†’ VectorDBManager.create_vector_db()
         â†’ add_project_file_record() (è®°å½•åˆ°SQLite)
```

---

### 4.5 å·¥å…·å±‚ (src/utils/)

#### 4.5.1 æ•°æ®åº“æ¨¡å— (`db.py`)

**èŒè´£**ï¼šSQLite æ•°æ®åº“æ“ä½œï¼Œç®¡ç†ä¼šè¯ã€æ¶ˆæ¯ã€çŸ¥è¯†åº“å…ƒæ•°æ®ã€‚

**æ•°æ®è¡¨ç»“æ„**ï¼š

```sql
-- çŸ¥è¯†åº“è¡¨
CREATE TABLE projects (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    created_at TEXT
);

-- ä¼šè¯è¡¨
CREATE TABLE sessions (
    id TEXT PRIMARY KEY,
    name TEXT,
    project_id TEXT,
    created_at TEXT
);

-- æ¶ˆæ¯è¡¨
CREATE TABLE messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT,
    role TEXT,           -- 'user' æˆ– 'assistant'
    content TEXT,
    created_at TEXT
);

-- æ–‡ä»¶è®°å½•è¡¨
CREATE TABLE project_files (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id TEXT,
    source TEXT,         -- æ–‡ä»¶å
    file_type TEXT,      -- æ–‡ä»¶ç±»å‹
    chunks_count INTEGER,
    created_at TEXT
);
```

**å…³é”®å‡½æ•°**ï¼š
```python
# åˆå§‹åŒ–æ•°æ®åº“ï¼ˆè‡ªåŠ¨å»ºè¡¨ï¼‰
init_db()

# é¡¹ç›®ç®¡ç†
create_project(project_id, name)
get_all_projects()
delete_project(project_id)

# ä¼šè¯ç®¡ç†
create_session(session_id, name, project_id)
get_sessions_by_project(project_id)
get_latest_session_by_project(project_id)

# æ¶ˆæ¯ç®¡ç†
save_message(session_id, role, content)
get_messages(session_id)

# æ–‡ä»¶è®°å½•
add_project_file_record(project_id, source, file_type, chunks_count)
list_project_files(project_id)

# ç»Ÿè®¡ä¿¡æ¯
get_project_stats(project_id)
```

#### 4.5.2 æ—¥å¿—æ¨¡å— (`logger.py`)

**èŒè´£**ï¼šç»Ÿä¸€çš„æ—¥å¿—é…ç½®ã€‚

```python
def setup_logger(name: str) -> logging.Logger:
    """
    é…ç½®å¹¶è¿”å›ä¸€ä¸ª logger å¯¹è±¡
    
    ç‰¹æ€§ï¼š
    - åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶
    - æ—¥å¿—è½®è½¬ï¼ˆ5MBä¸€ä¸ªæ–‡ä»¶ï¼Œä¿ç•™5ä¸ªå¤‡ä»½ï¼‰
    - UTF-8ç¼–ç æ”¯æŒä¸­æ–‡
    """
```

**æ—¥å¿—æ ¼å¼**ï¼š
```
2024-01-15 10:30:45,123 - RAG_ETL - INFO - ğŸ“„ æ­£åœ¨å¤„ç†: test.pdf
```

---

## 5. æ•°æ®æµä¸æ‰§è¡Œæµç¨‹

### 5.1 å®Œæ•´é—®ç­”æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ç”¨æˆ·æé—®ï¼š"Pythonæ˜¯ä»€ä¹ˆï¼Ÿ"                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ web_app.py: chat_input æ¥æ”¶ç”¨æˆ·è¾“å…¥                                          â”‚
â”‚   â†“                                                                         â”‚
â”‚ ChatService.save_user_message() â†’ ä¿å­˜åˆ° SQLite                             â”‚
â”‚   â†“                                                                         â”‚
â”‚ ChatService.stream_agent_response() â†’ è°ƒç”¨ Agent Graph                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LangGraph: app.stream(inputs, config)                                       â”‚
â”‚   â†“                                                                         â”‚
â”‚ è¿›å…¥ researcher èŠ‚ç‚¹                                                         â”‚
â”‚   â†“                                                                         â”‚
â”‚ Researcher åˆ†æï¼šéœ€è¦æŸ¥çŸ¥è¯†åº“ â†’ è¿”å› tool_calls: [ask_knowledge_base]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿›å…¥ tools èŠ‚ç‚¹ (ToolNode)                                                   â”‚
â”‚   â†“                                                                         â”‚
â”‚ æ‰§è¡Œ ask_knowledge_base("Pythonæ˜¯ä»€ä¹ˆ")                                      â”‚
â”‚   â†“                                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ RAGGenerator.get_answer()                                            â”‚     â”‚
â”‚ â”‚   â†“                                                                  â”‚     â”‚
â”‚ â”‚ VectorRetriever.query() â†’ ChromaDB.similarity_search_with_score()    â”‚     â”‚
â”‚ â”‚   â†“                                                                  â”‚     â”‚
â”‚ â”‚ è¿”å›: [(Document("Pythonæ˜¯..."), 0.85), ...]                         â”‚     â”‚
â”‚ â”‚   â†“                                                                  â”‚     â”‚
â”‚ â”‚ _format_docs() â†’ æ ¼å¼åŒ–ä¸Šä¸‹æ–‡                                         â”‚     â”‚
â”‚ â”‚   â†“                                                                  â”‚     â”‚
â”‚ â”‚ prompt | llm | parser â†’ ç”Ÿæˆåˆæ­¥ç­”æ¡ˆ                                  â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚   â†“                                                                         â”‚
â”‚ è¿”å› ToolMessage                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å›åˆ° researcher èŠ‚ç‚¹                                                         â”‚
â”‚   â†“                                                                         â”‚
â”‚ Researcher æŸ¥çœ‹å·¥å…·è¿”å›ç»“æœ â†’ åˆ¤æ–­ä¿¡æ¯è¶³å¤Ÿ â†’ ä¸å†è°ƒç”¨å·¥å…·                      â”‚
â”‚   â†“                                                                         â”‚
â”‚ should_continue() è¿”å› "writer"                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿›å…¥ writer èŠ‚ç‚¹                                                             â”‚
â”‚   â†“                                                                         â”‚
â”‚ Writer è¯»å–å®Œæ•´å¯¹è¯å†å²ï¼ˆåŒ…å«å·¥å…·è¿”å›çš„å†…å®¹ï¼‰                                   â”‚
â”‚   â†“                                                                         â”‚
â”‚ åŸºäºäº‹å®æ’°å†™æœ€ç»ˆå›ç­”                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LangGraph: æµç¨‹ç»“æŸï¼Œè¿”å›æœ€ç»ˆå“åº”                                             â”‚
â”‚   â†“                                                                         â”‚
â”‚ ChatService æ¥æ”¶å“åº”                                                         â”‚
â”‚   â†“                                                                         â”‚
â”‚ save_assistant_message() â†’ ä¿å­˜åˆ° SQLite                                     â”‚
â”‚   â†“                                                                         â”‚
â”‚ web_app.py: st.markdown() æ˜¾ç¤ºç»™ç”¨æˆ·                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ–‡æ¡£å…¥åº“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶: report.pdf                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ web_app.py: st.file_uploader() æ¥æ”¶æ–‡ä»¶                                      â”‚
â”‚   â†“                                                                         â”‚
â”‚ DocumentService.process_and_ingest()                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ContentProcessor.load_uploaded_files()                                       â”‚
â”‚   â†“                                                                         â”‚
â”‚ 1. åˆ›å»ºä¸´æ—¶æ–‡ä»¶ (tempfile.NamedTemporaryFile)                                â”‚
â”‚ 2. æ ¹æ®åç¼€é€‰æ‹© Loader (PyPDFLoader)                                         â”‚
â”‚ 3. loader.load() â†’ æå–æ–‡æœ¬                                                  â”‚
â”‚ 4. ä¿®å¤ metadata.source = åŸå§‹æ–‡ä»¶å                                         â”‚
â”‚ 5. æ¸…ç†ä¸´æ—¶æ–‡ä»¶                                                              â”‚
â”‚   â†“                                                                         â”‚
â”‚ è¿”å›: [Document(page_content="...", metadata={source: "report.pdf", ...})]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ContentProcessor.split_documents()                                           â”‚
â”‚   â†“                                                                         â”‚
â”‚ 1. æ ¹æ®æ–‡ä»¶ç±»å‹é€‰æ‹©åˆ†éš”ç¬¦ç­–ç•¥                                                 â”‚
â”‚ 2. RecursiveCharacterTextSplitter                                           â”‚
â”‚    - chunk_size=800, chunk_overlap=100                                      â”‚
â”‚ 3. é€’å½’åˆ‡åˆ†ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´                                                     â”‚
â”‚   â†“                                                                         â”‚
â”‚ è¿”å›: [Document(chunk1), Document(chunk2), ...]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VectorDBManager.create_vector_db()                                           â”‚
â”‚   â†“                                                                         â”‚
â”‚ 1. ä¸ºæ¯ä¸ª chunk æ·»åŠ  metadata.project_id                                     â”‚
â”‚ 2. Chroma.add_documents()                                                   â”‚
â”‚    - OpenAIEmbeddings å°†æ–‡æœ¬è½¬ä¸ºå‘é‡                                         â”‚
â”‚    - å­˜å‚¨åˆ° data/vector_db/                                                  â”‚
â”‚   â†“                                                                         â”‚
â”‚ è¿”å›: Chroma å¯¹è±¡                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ add_project_file_record() â†’ SQLite                                          â”‚
â”‚   â†“                                                                         â”‚
â”‚ è®°å½•æ–‡ä»¶å…¥åº“ä¿¡æ¯ï¼ˆç”¨äºUIå±•ç¤ºï¼‰                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. æ ¸å¿ƒæŠ€æœ¯çŸ¥è¯†ç‚¹

### 6.1 RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰

**æ¦‚å¿µ**ï¼šç»“åˆæ£€ç´¢å’Œç”Ÿæˆçš„æŠ€æœ¯ï¼Œé€šè¿‡å¤–éƒ¨çŸ¥è¯†åº“å¢å¼º LLM çš„å›ç­”èƒ½åŠ›ã€‚

**æ ¸å¿ƒæµç¨‹**ï¼š
1. **ç´¢å¼•é˜¶æ®µ**ï¼šæ–‡æ¡£ â†’ åˆ‡åˆ† â†’ å‘é‡åŒ– â†’ å­˜å…¥å‘é‡æ•°æ®åº“
2. **æ£€ç´¢é˜¶æ®µ**ï¼šé—®é¢˜ â†’ å‘é‡åŒ– â†’ ç›¸ä¼¼åº¦æœç´¢ â†’ è¿”å›ç›¸å…³æ–‡æ¡£
3. **ç”Ÿæˆé˜¶æ®µ**ï¼šPrompt = ä¸Šä¸‹æ–‡ + é—®é¢˜ â†’ LLM â†’ ç­”æ¡ˆ

**ä¼˜åŠ¿**ï¼š
- è§£å†³ LLM çŸ¥è¯†æˆªæ­¢é—®é¢˜
- å‡å°‘å¹»è§‰ï¼ˆHallucinationï¼‰
- æ”¯æŒç§æœ‰/ä¼ä¸šçŸ¥è¯†åº“

### 6.2 å‘é‡åµŒå…¥ï¼ˆEmbeddingï¼‰

**æ¦‚å¿µ**ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºé«˜ç»´å‘é‡è¡¨ç¤ºã€‚

**ç‰¹ç‚¹**ï¼š
- è¯­ä¹‰ç›¸è¿‘çš„æ–‡æœ¬åœ¨å‘é‡ç©ºé—´ä¸­è·ç¦»è¾ƒè¿‘
- æ”¯æŒæ¨¡ç³Š/è¯­ä¹‰æœç´¢ï¼Œè€Œéå…³é”®è¯åŒ¹é…

**å¸¸ç”¨æ¨¡å‹**ï¼š
- OpenAI: `text-embedding-3-small`, `text-embedding-3-large`
- å¼€æº: `bge-large-zh`, `m3e-base`

### 6.3 LangChain æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ |
|-----|------|
| **Message** | æ¶ˆæ¯å¯¹è±¡ï¼ˆHumanMessage, AIMessage, SystemMessage, ToolMessageï¼‰ |
| **Prompt Template** | æç¤ºè¯æ¨¡æ¿ï¼Œæ”¯æŒå˜é‡æ›¿æ¢ |
| **LCEL** | LangChain Expression Languageï¼Œé“¾å¼è°ƒç”¨è¯­æ³• |
| **Tool** | å¯è¢« LLM è°ƒç”¨çš„å‡½æ•° |
| **Chain** | å¤šä¸ªç»„ä»¶çš„ç»„åˆ |

### 6.4 LangGraph æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ |
|-----|------|
| **StateGraph** | åŸºäºçŠ¶æ€çš„å›¾ç»“æ„ |
| **Node** | å›¾ä¸­çš„èŠ‚ç‚¹ï¼Œå¤„ç†çŠ¶æ€å¹¶è¿”å›æ›´æ–° |
| **Edge** | èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ï¼Œå®šä¹‰æµç¨‹æ–¹å‘ |
| **Conditional Edge** | æ¡ä»¶è¾¹ï¼Œæ ¹æ®çŠ¶æ€åŠ¨æ€é€‰æ‹©ä¸‹ä¸€èŠ‚ç‚¹ |
| **State** | åœ¨èŠ‚ç‚¹é—´ä¼ é€’çš„æ•°æ®ç»“æ„ |

### 6.5 å¤šæ™ºèƒ½ä½“åä½œæ¨¡å¼

**æœ¬é¡¹ç›®é‡‡ç”¨çš„æ¨¡å¼**ï¼šæµæ°´çº¿åä½œ

```
Researcher (ç ”ç©¶å‘˜)          Writer (ä½œå®¶)
     â”‚                           â”‚
     â”‚ 1. åˆ†æç”¨æˆ·æ„å›¾            â”‚
     â”‚ 2. å†³å®šæ˜¯å¦éœ€è¦å·¥å…·        â”‚
     â”‚ 3. è°ƒç”¨å·¥å…·è·å–ä¿¡æ¯        â”‚
     â”‚                           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€ ä¼ é€’ä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
                                 â”‚ 4. æ•´ç†ä¿¡æ¯
                                 â”‚ 5. ç”Ÿæˆæœ€ç»ˆå›ç­”
```

**è®¾è®¡åŸåˆ™**ï¼š
- å•ä¸€èŒè´£ï¼šæ¯ä¸ª Agent åªåšä¸€ä»¶äº‹
- è§’è‰²æ‰®æ¼”ï¼šé€šè¿‡ System Prompt å®šä¹‰ Agent çš„"äººè®¾"
- è¿­ä»£åä½œï¼šResearcher å¯ä»¥å¤šæ¬¡è°ƒç”¨å·¥å…·ï¼Œç›´åˆ°ä¿¡æ¯è¶³å¤Ÿ

### 6.6 çŸ¥è¯†åº“éš”ç¦»æŠ€æœ¯

**å®ç°æ–¹å¼**ï¼šå…ƒæ•°æ®è¿‡æ»¤ï¼ˆMetadata Filteringï¼‰

```python
# å…¥åº“æ—¶æ·»åŠ  project_id
for chunk in chunks:
    chunk.metadata["project_id"] = project_id

# æ£€ç´¢æ—¶è¿‡æ»¤
results = vector_db.similarity_search(
    query,
    filter={"project_id": project_id}
)
```

**ä¼˜åŠ¿**ï¼š
- å•ä¸€å‘é‡æ•°æ®åº“æ”¯æŒå¤šç§Ÿæˆ·
- æ•°æ®éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°
- èŠ‚çœèµ„æº

---

## 7. ä¾èµ–ä¸ç¯å¢ƒé…ç½®

### 7.1 æ ¸å¿ƒä¾èµ–

```bash
# LangChain ç”Ÿæ€
langchain                  # åŸºç¡€æ¡†æ¶
langchain-openai          # OpenAI é›†æˆ
langchain-community       # ç¤¾åŒºç»„ä»¶ï¼ˆLoaderç­‰ï¼‰
langchain-text-splitters  # æ–‡æœ¬åˆ‡åˆ†å™¨
langchain-chroma          # ChromaDB é›†æˆ

# LangGraph
langgraph                 # å¤šæ™ºèƒ½ä½“ç¼–æ’

# å‘é‡æ•°æ®åº“
chromadb                  # æœ¬åœ°å‘é‡æ•°æ®åº“

# Webæ¡†æ¶
streamlit                 # Web UI

# å·¥å…·åº“
python-dotenv             # ç¯å¢ƒå˜é‡
```

### 7.2 å®‰è£…å‘½ä»¤

```bash
pip install langchain langchain-openai langchain-community langgraph chromadb python-dotenv streamlit
```

### 7.3 ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# OpenAI API é…ç½®
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxx
OPENAI_API_BASE=https://api.openai.com/v1  # æˆ–ä»£ç†åœ°å€
```

---

## 8. ä½¿ç”¨æŒ‡å—

### 8.1 å¯åŠ¨ Web åº”ç”¨

```bash
streamlit run web_app.py
```

### 8.2 å‘½ä»¤è¡Œäº¤äº’

```bash
python main.py
```

### 8.3 çŸ¥è¯†å…¥åº“è„šæœ¬

```bash
python scripts/ingest_knowledge.py
```

### 8.4 ä½¿ç”¨æµç¨‹

1. **åˆ›å»ºçŸ¥è¯†åº“**ï¼šåœ¨çŸ¥è¯†åº“ç®¡ç†é¡µé¢åˆ›å»ºæ–°çš„çŸ¥è¯†åº“ï¼ˆæˆ–ä½¿ç”¨é»˜è®¤çš„ï¼‰
2. **ä¸Šä¼ æ–‡æ¡£**ï¼šåœ¨èŠå¤©é¡µé¢çš„ä¾§è¾¹æ ä¸Šä¼ æ–‡æ¡£
3. **å¼€å§‹å¯¹è¯**ï¼šåœ¨èŠå¤©æ¡†è¾“å…¥é—®é¢˜ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä»çŸ¥è¯†åº“æ£€ç´¢å¹¶ç”Ÿæˆå›ç­”

---

## 9. æ‰©å±•ä¸äºŒæ¬¡å¼€å‘

### 9.1 æ·»åŠ æ–°çš„æ–‡æ¡£ç±»å‹æ”¯æŒ

åœ¨ `src/rag/etl.py` çš„ `_select_loader` æ–¹æ³•ä¸­æ·»åŠ ï¼š

```python
elif suffix == ".xlsx":
    return YourExcelLoader(file_path)
```

### 9.2 æ·»åŠ æ–°çš„å·¥å…·

åœ¨ `src/agent/tools.py` ä¸­æ·»åŠ ï¼š

```python
@tool
def my_new_tool(param: str, config: RunnableConfig) -> str:
    """
    å·¥å…·æè¿°ï¼ˆLLMä¼šè¯»å–è¿™ä¸ªæè¿°æ¥å†³å®šæ˜¯å¦è°ƒç”¨ï¼‰
    """
    # å®ç°é€»è¾‘
    return result
```

ç„¶ååœ¨ `all_tools` åˆ—è¡¨ä¸­æ·»åŠ è¯¥å·¥å…·ã€‚

### 9.3 æ·»åŠ æ–°çš„ Agent èŠ‚ç‚¹

1. åœ¨ `src/agent/nodes.py` ä¸­å®ç°èŠ‚ç‚¹å‡½æ•°
2. åœ¨ `src/agent/graph.py` ä¸­æ³¨å†ŒèŠ‚ç‚¹
3. å®šä¹‰èŠ‚ç‚¹é—´çš„æµè½¬é€»è¾‘

### 9.4 åˆ‡æ¢ Embedding æ¨¡å‹

åœ¨ `config/settings.py` ä¸­ä¿®æ”¹ï¼š

```python
EMBEDDING_MODEL = "text-embedding-3-large"  # æˆ–å…¶ä»–æ¨¡å‹
```

### 9.5 åˆ‡æ¢ LLM æ¨¡å‹

```python
CHAT_MODEL = "gpt-4"  # æˆ–å…¶ä»–æ¨¡å‹
```

---

## é™„å½•ï¼šå¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ£€ç´¢ä¸åˆ°å†…å®¹ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
1. æ–‡æ¡£æœªæ­£ç¡®å…¥åº“ â†’ æ£€æŸ¥ `data/vector_db/` ç›®å½•
2. `project_id` ä¸åŒ¹é… â†’ ç¡®è®¤å½“å‰é€‰ä¸­çš„çŸ¥è¯†åº“
3. å‘é‡æ•°æ®åº“æŸå â†’ åˆ é™¤ `data/vector_db/` é‡æ–°å…¥åº“

### Q2: å¦‚ä½•æé«˜æ£€ç´¢è´¨é‡ï¼Ÿ

**ä¼˜åŒ–æ–¹å‘**ï¼š
1. è°ƒæ•´ `CHUNK_SIZE` å’Œ `CHUNK_OVERLAP`
2. ä½¿ç”¨æ›´å¥½çš„ Embedding æ¨¡å‹
3. å¢åŠ é‡æ’åºï¼ˆRerankï¼‰æ­¥éª¤
4. ä¼˜åŒ–åˆ‡åˆ†ç­–ç•¥ï¼ˆå¦‚æŒ‰æ®µè½ã€æŒ‰ç« èŠ‚ï¼‰

### Q3: å¦‚ä½•æ”¯æŒæ›´å¤šæ–‡ä»¶ç±»å‹ï¼Ÿ

**æ‰©å±•æ–¹æ³•**ï¼š
1. å®‰è£…å¯¹åº”çš„ Loader ä¾èµ–
2. åœ¨ `etl.py` çš„ `_select_loader` ä¸­æ·»åŠ åˆ†æ”¯

### Q4: å¤šæ™ºèƒ½ä½“ä¸ºä»€ä¹ˆä¼šå¾ªç¯è°ƒç”¨ï¼Ÿ

**æ’æŸ¥æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `should_continue` çš„é€»è¾‘
2. ç¡®è®¤ Researcher çš„ System Prompt æ˜¯å¦æ­£ç¡®å¼•å¯¼
3. æ·»åŠ æœ€å¤§è¿­ä»£æ¬¡æ•°é™åˆ¶

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2024å¹´